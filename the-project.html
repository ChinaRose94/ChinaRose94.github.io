<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAEtron Systems | v1.1.0</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* FONT STACK */
        @import url('https://fonts.googleapis.com/css2?family=VT323&family=Share+Tech+Mono&family=Courier+Prime:wght@400;700&family=Orbitron:wght@700&display=swap');

        :root {
            --term-green: #4ade80; 
            --term-amber: #fbbf24;
            
            /* The "Slate/Faded Blue" Palette */
            --bg-darker: #020617;  
            --bg-dark: #0f172a;    
            --win-bg: #1e293b;     
            /* UPDATED: Made slightly lighter to pop against background */
            --win-header: #475569; 
            --win-border: #64748b; 
        }

        body {
            margin: 0;
            overflow: hidden;
            background-color: var(--bg-darker);
            font-family: 'VT323', monospace;
            user-select: none;
            color: var(--term-green);
            -webkit-font-smoothing: antialiased;
        }

        /* --- CRT Effects --- */
        .bloom-amber { text-shadow: 0 0 5px rgba(251, 191, 36, 0.7); }
        .bloom-green { text-shadow: 0 0 5px rgba(74, 222, 128, 0.7); }
        .bloom-blue { text-shadow: 0 0 5px rgba(59, 130, 246, 0.7); }
        .bloom-red { text-shadow: 0 0 5px rgba(239, 68, 68, 0.7); }
        .bloom-white { text-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
        
        .scanlines {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            background-size: 100% 3px, 3px 100%;
            pointer-events: none;
            z-index: 999;
            opacity: 0.3; 
        }

        .screen-glow {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            box-shadow: inset 0 0 150px rgba(15, 23, 42, 0.6);
            background: radial-gradient(circle, rgba(30, 41, 59, 0.0) 0%, rgba(2, 6, 23, 0.6) 90%);
            pointer-events: none;
            z-index: 998;
        }

        /* --- UI Elements --- */
        ::-webkit-scrollbar { width: 10px; background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: var(--win-border); border: 1px solid var(--bg-dark); }
        ::-webkit-scrollbar-thumb:hover { background: var(--term-green); }

        .raetron-window {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 1), 0 0 15px rgba(30, 41, 59, 0.5);
            border: 1px solid var(--win-border);
            background: var(--win-bg);
        }

        .raetron-title-bar {
            background: var(--win-header);
            color: #f1f5f9; /* Slate 100 - Brighter */
            font-family: 'Share Tech Mono', monospace;
            font-weight: bold;
            letter-spacing: 1px;
            border-bottom: 1px solid var(--win-border);
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }
        
        /* NEW: Pulse animation for the close instruction */
        .pulse-text { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }

        /* --- Animations & Glitch --- */
        .blink { animation: blinker 1s steps(2, start) infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

        .glitch { position: relative; }
        .glitch::before, .glitch::after {
            content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.8;
        }
        .glitch::before {
            left: 2px; text-shadow: -2px 0 #ff00c1; clip-path: polygon(0 0, 100% 0, 100% 45%, 0 45%);
            animation: glitch-anim 3s infinite linear alternate-reverse;
        }
        .glitch::after {
            left: -2px; text-shadow: -2px 0 #00fff9; clip-path: polygon(0 55%, 100% 55%, 100% 100%, 0 100%);
            animation: glitch-anim2 2s infinite linear alternate-reverse;
        }
        @keyframes glitch-anim {
            0% { clip-path: inset(10% 0 80% 0); } 100% { clip-path: inset(20% 0 70% 0); }
        }
        @keyframes glitch-anim2 {
            0% { clip-path: inset(60% 0 20% 0); } 100% { clip-path: inset(70% 0 20% 0); }
        }

        /* Typography Utilities */
        .font-title { font-family: 'Orbitron', sans-serif; }
        .font-ui { font-family: 'Share Tech Mono', monospace; }
        .font-doc { font-family: 'Courier Prime', monospace; }
        .font-term { font-family: 'VT323', monospace; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- DATA ---
        const STORY_CHAPTERS = [
            { 
                id: 0, 
                title: "FILE_00: PROJECT_SUMMARY.TXT", 
                text: `CLASSIFIED SUMMARY // CLEARANCE LEVEL 1\n\nYEAR: 1986\nLOCATION: Queens Village, NY\n\nSUBJECT: THE RAE-TRON INCIDENT\n\nRobbie Kingsley didn't care about scientific breakthroughs. He just wanted the $5,000 Grand Prize from the RAEtron Science Fair to buy a pair of green suede Vans and redeem his reputation.\n\nTo win, he recruited a team of local outcasts ("The Misfits") to attempt the impossible: construct a fully immersive Virtual Reality system in Cassandra Simmons' basement, utilizing the cryptic schematics and dormant mainframe left behind by a vanished scientist, Dr. Alexander Stevens.\n\nBut they didn't realize that Stevens hadn't just designed a game engine. He had built a bridge.\n\nWhen the team powered up the prototype, they didn't just simulate a new world—they tore a hole in the fabric of this one. Now, the "glitches" aren't staying on the screen. Shadows are manifesting in the streets of Queens Village, and the code is bleeding into reality.\n\nCAUTION: The signal is active. Information contained herein is cognitively hazardous. Proceed at your own risk.\n\n> END SUMMARY` 
            },
            { id: 1, title: "CH_01: FROM VANS TO VIRTUAL", text: "Dust and debris formed layers in the abandoned basement research facility. A gust of fall air burst through the small, cracked window panel. A book flipped open, revealing the contents of its pages, which bore the work of the brilliant Dr. Alexander Stevens. It was clear that he followed in the footsteps of Ivan Sutherland, \"The Father of Virtual Reality\". But that was in 1965.\n\nOver twenty years later, Stevens’ work faded into obscurity as he vanished without a trace. He left only his legacy behind that was slowly overshadowed by newer advancements in technology. Yet none achieved the potential of his magnum opus. There in the shadowed corner sat the dormant traces of his HyperRealm Nexus, of which, like Dr. Stevens, was nowhere to be found.\n\nThe eerie quiet was displaced only by the sporadic crackling and buzzing sounds from old computer monitors. One monitor, like a sentinel, beckoned someone to uncover the laboratory's dark potential as a green cursor blinked to life on a black screen..." },
            { id: 2, title: "CH_02: THE MISFITS", text: "Robbie found Ben in front of school the next morning before 1st period. He took a deep breath as he approached. He was a pro at donning his cool, charming facade; it had become second-nature to him, a protective shield against any fear or doubt that threatened to interrupt his latest plan.\n\n“So last night I stayed up, going over the schematics in my head,” Robbie said. He handed Ben, a dog-eared notebook, opened to a page with what looked like scribble. As Ben glanced at the page, a small ‘hmm’ escaped his lips.\n“What do you see?” Robbie asked curiously.\nBen slowly looked up and replied with a stoic look in his eyes, “Judging by all the necessary elements needed... I see that it's not reasonable to do this on our own.”" },
            { id: 3, title: "CH_03: GLITCHES", text: "Vince Myers walked through the neighborhood park on a Saturday morning with his new friend Jimmy, an exceedingly popular Junior on the varsity football team. Jimmy had carefully built up a bad boy reputation and Vince was key in keeping up the appearance. They scanned for the target. Today’s agenda: The new kid who Jimmy thought could be trouble.\n\nRobbie and his friends strode into the park so that Josie could sketch out the landscape. They happened upon the scene that just took place with Vince and froze with uncertainty and caution..." }
        ];

        // ADD YOUR IMAGE PATHS HERE
        const CHARACTERS = [
            { id: 1, name: "Robbie Kingsley", role: "PROJECT LEADER", stats: "STR:4 INT:7 CHA:8", desc: "Driven by redemption. Wants the green suede Vans. Haunted by failure.", status: "ACTIVE", img: "images/robbie.png" },
            { id: 2, name: "Cassandra Simmons", role: "TECH SPECIALIST", stats: "STR:3 INT:9 CHA:9", desc: "Secret genius masking as popular. Her basement is Ground Zero.", status: "ACTIVE", img: "images/cassie.png" },
            { id: 3, name: "Jayendra Chakrabarti", role: "VISUAL ANALYST", stats: "STR:2 INT:10 CHA:3", desc: "Technical wizard. Arrogant but essential. First to see anomalies.", status: "PERCEPTIVE", img: "images/jay.png" },
            { id: 4, name: "Benjamin Zhang", role: "SYSTEMS ARCHITECT", stats: "STR:6 INT:6 CHA:7", desc: "Robbie's moral compass. Immigrant family background. Keeps the team grounded.", status: "ACTIVE", img: "images/ben.png" },
            { id: 5, name: "Derek Rosemont", role: "AUDIO ANALYST", stats: "STR:5 INT:8 CHA:5", desc: "Sound engineer. His music triggers the dimensional rifts.", status: "SKEPTIC", img: "images/derek.png" },
            { id: 6, name: "Josie Wilder", role: "INTEL SPECIALIST", stats: "STR:3 INT:7 CHA:4", desc: "Visualizer. Escaping a toxic home life through the VR world.", status: "OBSERVANT", img: "images/josie.png" },
            { id: 7, name: "Vincent Myers", role: "SECURITY RISK", stats: "STR:9 INT:4 CHA:5", desc: "The bully with a hidden conscience. Caught between survival and redemption.", status: "MONITORED", img: "images/vince.png" },
            { id: 8, name: "Shelby DiMario", role: "STREET OPERATIVE", stats: "STR:6 INT:5 CHA:8", desc: "Rebellious spirit. Knows the streets better than anyone.", status: "REBELLIOUS", img: "images/shelby.png" }
        ];

        const DEEP_DIVES = [
            { id: 1, title: "STRANGE SCIENCE", label: "QUANTUM ENTANGLEMENT", content: "THEORY:\nThe VR system creates conditions that allow quantum mechanical effects to manifest in the real world. By utilizing specific sound frequencies (cymatics) and electromagnetic forces, the system achieves 'Quantum Coherence' over macro scales.\n\nSWIMMING POOL ANALOGY:\nImagine reality as two overlapping swimming pools. The VR system acts like a drill creating holes between them, allowing water (particles) to flow between and blend the two pools." },
            { id: 2, title: "HYPERREALM NEXUS", label: "CLASSIFIED: DR. STEVENS", content: "SUBJECT: DR. ALEXANDER STEVENS (1965)\nSTATUS: MISSING / ERASED\n\nDr. Stevens followed in the footsteps of Ivan Sutherland ('The Father of VR'). Over 20 years ago, he built the original 'HyperRealm Nexus' in the very basement Cassie now uses.\n\nTHE GLITCH:\nThe kids did not invent the gateway; they *reactivated* it." },
            { id: 3, title: "SHADOW BEASTS", label: "THREAT LEVEL: EXTREME", content: "SUBJECT: NON-ENTROPIC ENTITIES ('SHADOWS')\nORIGIN: EXTRA-DIMENSIONAL\n\nThese entities are composed of 'incoherent matter.' They are attracted to the order and structure of our reality.\n\nOBSERVATIONS:\n- First sighted in school hallways.\n- Manifest as flickering silhouettes.\n- Respond to emotional states and fear." }
        ];

        // --- SVGs ---
        const Icons = {
            Terminal: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="4 17 10 11 4 5"></polyline><line x1="12" y1="19" x2="20" y2="19"></line></svg>,
            Disk: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><path d="M12 4v6h6"></path><path d="M4 20v-6h16v6"></path></svg>,
            Mail: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>,
            Folder: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>,
            User: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>,
            Tie: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><path d="M3 6h18"></path><path d="M12 6v16"></path></svg>,
            Database: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path></svg>,
            Minimize: () => <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><rect x="2" y="18" width="20" height="2" /></svg>,
            Close: () => <svg width="12" height="12" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="3"><line x1="2" y1="2" x2="22" y2="22" /><line x1="22" y1="2" x2="2" y2="22" /></svg>,
            Start: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="2" y="2" width="8" height="8"/><rect x="14" y="2" width="8" height="8"/><rect x="2" y="14" width="8" height="8"/><rect x="14" y="14" width="8" height="8"/></svg>
        };

        // --- Components ---

        const DraggableWindow = ({ id, title, isOpen, isMinimized, zIndex, position, content, onClose, onMinimize, onFocus, onMove }) => {
            const [isDragging, setIsDragging] = useState(false);
            const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });
            const windowRef = useRef(null);

            const handleMouseDown = (e) => {
                onFocus(id);
                setIsDragging(true);
                if (windowRef.current) {
                    const rect = windowRef.current.getBoundingClientRect();
                    setDragOffset({ x: e.clientX - rect.left, y: e.clientY - rect.top });
                }
            };

            useEffect(() => {
                const handleMouseUp = () => setIsDragging(false);
                const handleMouseMove = (e) => {
                    if (isDragging) {
                        onMove(id, { x: e.clientX - dragOffset.x, y: e.clientY - dragOffset.y });
                    }
                };
                if (isDragging) {
                    window.addEventListener('mousemove', handleMouseMove);
                    window.addEventListener('mouseup', handleMouseUp);
                }
                return () => {
                    window.removeEventListener('mousemove', handleMouseMove);
                    window.removeEventListener('mouseup', handleMouseUp);
                };
            }, [isDragging, id, onMove, dragOffset]);

            if (!isOpen || isMinimized) return null;

            return (
                <div 
                    ref={windowRef}
                    className="absolute raetron-window flex flex-col overflow-hidden"
                    style={{ 
                        left: position.x, top: position.y, zIndex: zIndex,
                        width: window.innerWidth < 640 ? '94%' : '720px',
                        height: window.innerWidth < 640 ? '75%' : '520px',
                        transform: (typeof position.x === 'string' && position.x === '50%' && !isDragging) ? 'translate(-50%, -50%)' : 'none'
                    }}
                    onMouseDown={() => onFocus(id)}
                >
                    <div className="h-8 raetron-title-bar flex items-center justify-between px-2 select-none cursor-move" onMouseDown={handleMouseDown}>
                        <div className="flex items-center gap-2 text-slate-100">
                            {id === 'welcome' && <Icons.Terminal />}
                            {id === 'chars' && <Icons.User />}
                            {id === 'ceo' && <Icons.Tie />}
                            <span className="font-ui tracking-wider pt-1 bloom-white">{title}</span>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={(e) => { e.stopPropagation(); onMinimize(id); }} className="text-slate-300 hover:text-white"><Icons.Minimize /></button>
                            {/* UPDATED: Made Close button RED by default for visibility */}
                            <button onClick={(e) => { e.stopPropagation(); onClose(id); }} className="text-red-500 hover:text-red-400 hover:scale-110 transition-transform"><Icons.Close /></button>
                        </div>
                    </div>
                    <div className="flex-1 bg-slate-900 p-1 overflow-auto relative">
                        {content}
                    </div>
                </div>
            );
        };

        const WelcomeContent = ({ openWindow }) => (
            <div className="h-full w-full bg-slate-950 text-slate-300 p-6 font-term text-xl overflow-y-auto flex flex-col">
                
                <div className="border-2 border-slate-700 p-8 mb-8 text-center bg-[#020617] relative overflow-hidden shadow-xl">
                    <div className="relative z-10">
                        <h1 className="text-4xl md:text-7xl mb-2 font-bold text-slate-100 glitch font-title tracking-widest bloom-white" data-text="THE PROJECT">THE PROJECT</h1>
                        <div className="h-px bg-amber-900/50 w-1/2 mx-auto my-4"></div>
                        <h2 className="text-sm md:text-2xl tracking-[0.3em] text-amber-500 font-ui bloom-amber">
                            RAETRON ENTERPRISES
                        </h2>
                        <p className="font-doc text-xs md:text-sm text-slate-500 uppercase pt-2 tracking-widest">
                            "INNOVATING TOMORROW, TODAY"
                        </p>
                    </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                    <div className="border border-slate-700 p-4 hover:border-blue-500 hover:bg-slate-800/50 transition-colors cursor-pointer group bg-[#0f172a]" onClick={() => openWindow('story', 'CHAPTER_PREVIEW.DOC')}>
                        <h3 className="font-ui text-lg text-blue-400 group-hover:text-blue-300 mb-2 border-b border-slate-700 pb-1 bloom-blue">PROJECT ARCHIVE</h3>
                        <p className="font-doc text-sm text-slate-500">FILE: PROJECT_SUMMARY.TXT</p>
                        <p className="text-green-400 font-bold blink mt-2 font-term">> ACCESS MANUSCRIPT_</p>
                    </div>
                    <div className="border border-slate-700 p-4 hover:border-amber-500 hover:bg-slate-800/50 transition-colors cursor-pointer group bg-[#0f172a]" onClick={() => openWindow('buy', 'ACQUIRE_ASSET.EXE')}>
                        <h3 className="font-ui text-lg text-amber-500 group-hover:text-amber-300 mb-2 border-b border-slate-700 pb-1 bloom-amber">REQUISITION</h3>
                        <p className="font-doc text-sm text-slate-500">STOCK: LIMITED</p>
                        <p className="text-green-400 font-bold mt-2 font-term">> INITIATE ORDER_</p>
                    </div>
                </div>

                {/* NEW: Explicit Instructions for the User at the bottom */}
                <div className="mt-auto border-t border-slate-800 pt-4 text-center">
                    <p className="font-ui text-sm text-slate-500 mb-1">SYSTEM MESSAGE:</p>
                    <p className="font-term text-green-500 pulse-text">
                        [ CLOSE THIS WINDOW TO ACCESS DESKTOP ICONS ]
                    </p>
                </div>
            </div>
        );

        const StoryContent = () => {
            const [activeChapter, setActiveChapter] = useState(STORY_CHAPTERS[0]);
            return (
                <div className="h-full flex flex-col md:flex-row bg-slate-950 text-slate-300 font-doc text-sm">
                    <div className="w-full md:w-1/3 border-r border-slate-700 bg-slate-900 overflow-y-auto p-2">
                        <div className="font-ui text-xs text-slate-500 mb-2 px-2 tracking-widest">AVAILABLE FILES:</div>
                        {STORY_CHAPTERS.map(chap => (
                            <button 
                                key={chap.id} 
                                onClick={() => setActiveChapter(chap)}
                                className={`w-full text-left p-2 mb-1 border font-ui text-xs ${activeChapter.id === chap.id ? 'border-blue-500 text-blue-400 bg-slate-800 bloom-blue' : 'border-transparent text-slate-400 hover:text-slate-200'}`}
                            >
                                {chap.title}
                            </button>
                        ))}
                    </div>
                    <div className="flex-1 p-6 overflow-y-auto bg-[#020617]">
                        <h2 className="text-xl text-blue-500 font-bold mb-4 border-b border-slate-800 pb-2 font-ui bloom-blue">{activeChapter.title}</h2>
                        <p className="whitespace-pre-wrap leading-relaxed text-slate-300 font-doc text-base">{activeChapter.text}</p>
                    </div>
                </div>
            );
        };

        const CharacterContent = () => (
            <div className="h-full w-full bg-slate-950 text-slate-300 p-4 font-ui overflow-y-auto">
                <h2 className="text-xl text-blue-400 font-bold mb-4 border-b border-slate-700 pb-1 bloom-blue tracking-widest">PERSONNEL DATABASE // CLASSIFIED</h2>
                <div className="grid gap-4">
                    {CHARACTERS.map(char => (
                        <div key={char.id} className="border border-slate-700 bg-[#0f172a] p-3 flex gap-4 group hover:border-blue-500 transition-all">
                            <div className="w-24 h-24 bg-slate-800 border border-slate-600 flex items-center justify-center text-slate-500 group-hover:text-blue-400 overflow-hidden relative">
                                {char.img ? (
                                    <img src={char.img} alt={char.name} className="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity grayscale group-hover:grayscale-0" />
                                ) : (
                                    <Icons.User />
                                )}
                            </div>
                            <div className="flex-1">
                                <div className="flex justify-between items-start">
                                    <h3 className="text-lg text-slate-200 font-bold bloom-white">{char.name}</h3>
                                    <span className={`text-xs px-1 border ${char.status === 'SECURITY RISK' ? 'border-red-500 text-red-500 bloom-red' : 'border-green-500 text-green-500 bloom-green'}`}>{char.status}</span>
                                </div>
                                <p className="text-blue-400 text-sm mb-1">{char.role}</p>
                                <p className="font-doc text-xs text-slate-400 leading-tight mb-2">{char.desc}</p>
                                <p className="font-term text-xs text-slate-600 mt-1">{char.stats}</p>
                            </div>
                        </div>
                    ))}
                </div>
            </div>
        );

        const DeepDiveContent = () => (
            <div className="h-full w-full bg-slate-950 text-slate-300 p-4 font-ui overflow-y-auto">
                <h2 className="text-xl text-red-500 font-bold mb-4 border-b border-red-900/50 pb-1 bloom-red tracking-widest">ANOMALY REPORTS // LEVEL 4</h2>
                <div className="space-y-4">
                    {DEEP_DIVES.map(dive => (
                        <div key={dive.id} className="border border-red-900/30 bg-red-950/10 p-4 hover:bg-red-950/20 transition-colors">
                            <div className="flex justify-between items-center mb-2">
                                <h3 className="text-lg text-red-400 font-bold bloom-red">{dive.title}</h3>
                                <span className="text-xs text-red-600 border border-red-900 px-1">{dive.label}</span>
                            </div>
                            <p className="font-doc text-sm text-slate-400 whitespace-pre-wrap">{dive.content}</p>
                        </div>
                    ))}
                </div>
            </div>
        );

        const CEOContent = () => (
            <div className="h-full w-full bg-slate-900 text-slate-300 p-6 flex flex-col overflow-y-auto font-doc">
                <div className="border-b-2 border-amber-700/50 pb-4 mb-4 flex gap-4 items-center">
                    <div className="w-20 h-24 border border-amber-600 bg-amber-900/20 flex items-center justify-center text-amber-500 bloom-amber">
                        <Icons.Tie />
                    </div>
                    <div>
                         <h2 className="font-ui text-sm text-amber-600 font-bold bloom-amber">VISIONARY CEO:</h2>
                         <h1 className="font-ui text-2xl text-slate-200 font-bold tracking-wider bloom-white">RAYMOND ROTHENBERG</h1>
                         <p className="text-xs text-slate-500 uppercase tracking-widest mt-1 font-ui">TIME MAGAZINE SPECIAL REPORT [1986]</p>
                    </div>
                </div>
                <div className="text-sm leading-relaxed text-slate-400 space-y-4 text-justify p-6 border border-slate-700 bg-[#020617]">
                    <p><strong className="text-amber-500">Raymond Rothenberg</strong>, founder and CEO of RAEtron Enterprises, is widely credited with architecting the modern technological landscape. His pioneering work in advanced computing and experimental interfaces has propelled humanity into a new era.</p>
                    <p>Under his leadership, RAEtron has moved beyond mere product manufacturing to become a dominant force in shaping global infrastructure. His vision of "Innovating Tomorrow, Today" drives the company's relentless pursuit of progress.</p>
                </div>
                <div className="mt-auto pt-4 border-t border-slate-700 font-term text-xs flex justify-between text-amber-700 bloom-amber">
                    <span>STATUS: ACTIVE / OMEGA</span>
                    <span>ID: RR-001-A</span>
                </div>
            </div>
        );

        const ConnectContent = () => {
            const [email, setEmail] = useState("");
            const [status, setStatus] = useState("IDLE");
            const [lines, setLines] = useState(["INITIATING SECURE HANDSHAKE...", "STATUS: AWAITING CREDENTIALS..."]);

            const handleSubmit = (e) => {
                e.preventDefault();
                setStatus("SENDING");
                setLines(prev => [...prev, `> PROCESSING: ${email}`, "> ENCRYPTING PACKET...", "> TRANSMITTING..."]);
                
                const formData = new FormData();
                formData.append('fields[email]', email);

                fetch('https://assets.mailerlite.com/jsonp/1804898/forms/165903246149289160/subscribe', { method: 'POST', body: formData, mode: 'no-cors' })
                .then(() => {
                    setTimeout(() => {
                        setStatus("SENT");
                        setLines(prev => [...prev, "> ACCESS GRANTED.", "> WELCOME TO RAE-NET."]);
                        setEmail("");
                    }, 1000);
                })
                .catch(() => { setLines(prev => [...prev, "> ERROR: UPLINK FAILED."]); setStatus("IDLE"); });
            };

            return (
                <div className="h-full bg-slate-950 text-green-500 p-4 font-term text-xl flex flex-col border border-slate-700 shadow-inner">
                    <div className="flex-1 overflow-y-auto mb-4 text-green-400/80 p-2 bloom-green">
                        {lines.map((line, i) => <div key={i} className="break-all mb-1">{line}</div>)}
                        {status === "IDLE" && <div className="blink">_</div>}
                    </div>
                    {status === "SENT" ? (
                         <div className="border border-green-600 p-2 text-center bg-green-900/20 text-green-400 font-bold bloom-green">UPLINK ESTABLISHED</div>
                    ) : (
                        <form onSubmit={handleSubmit} className="border-t border-slate-700 pt-4">
                            <div className="flex bg-black border border-slate-600 items-center p-1">
                                <span className="px-2 text-green-500 font-bold">></span>
                                <input type="email" value={email} onChange={(e) => setEmail(e.target.value)} className="bg-transparent border-none outline-none text-green-500 w-full p-1 font-term text-xl bloom-green" placeholder="USR@RAETRON.NET" autoFocus required disabled={status === "SENDING"} />
                            </div>
                            <button type="submit" disabled={status === "SENDING"} className="mt-2 bg-slate-800 text-slate-300 hover:text-white hover:bg-slate-700 w-full py-1 font-ui text-sm border border-slate-600 transition-colors">{status === "SENDING" ? "CONNECTING..." : "ESTABLISH CONNECTION"}</button>
                        </form>
                    )}
                </div>
            );
        };

        const BuyContent = () => (
            <div className="h-full bg-slate-950 text-slate-300 p-8 flex flex-col items-center justify-center text-center font-ui">
                <h2 className="text-2xl font-bold mb-6 border-b border-amber-600 pb-2 text-amber-500 bloom-amber tracking-widest">ACQUISITION CHANNELS</h2>
                <div className="w-full space-y-4">
                    {/* UPDATED: Patreon Link */}
                    <a href="https://www.patreon.com/cw/LilyRosslyn" target="_blank" className="block w-full border border-amber-500 p-4 bg-amber-900/10 hover:bg-amber-900/30 text-lg text-amber-400 font-bold transition-all bloom-amber">
                        [ JOIN THE ARCHIVE (PATREON) ]
                    </a>
                    
                    {/* UPDATED: Fourthwall Link */}
                    <a href="https://shop.lilyrosslyn.com" target="_blank" className="block w-full border border-blue-500 p-4 bg-blue-900/10 hover:bg-blue-900/30 text-lg text-blue-400 font-bold transition-all bloom-blue">
                        [ REQUISITION SUPPLIES (MERCH) ]
                    </a>
                    
                    {/* Flavor Text / Offline Links */}
                    <div className="block w-full border border-slate-700 p-3 text-slate-600 text-lg cursor-not-allowed bg-slate-900">
                        [ AMAZON TERMINAL (OFFLINE) ]
                    </div>
                </div>
            </div>
        );

        // --- Main App ---
        const App = () => {
            const [windows, setWindows] = useState([{ id: 'welcome', title: 'SYSTEM_ROOT', isOpen: true, isMinimized: false, zIndex: 10, position: { x: '50%', y: '50%' }, content: null }]);
            const [activeWindowId, setActiveWindowId] = useState('welcome');
            const [nextZIndex, setNextZIndex] = useState(11);
            const [startMenuOpen, setStartMenuOpen] = useState(false);

            useEffect(() => {
                const isMobile = window.innerWidth < 640;
                setWindows(prev => prev.map(w => ({ ...w, position: isMobile ? { x: 5, y: 5 } : w.position })));
            }, []);

            const openWindow = (id, title, contentComponent = null) => {
                setStartMenuOpen(false);
                setWindows(prev => {
                    const existing = prev.find(w => w.id === id);
                    if (existing) return prev.map(w => w.id === id ? { ...w, isOpen: true, isMinimized: false, zIndex: nextZIndex } : w);
                    
                    let content = contentComponent;
                    if (!content) {
                         if (id === 'welcome') content = <WelcomeContent openWindow={openWindow} />;
                         if (id === 'story') content = <StoryContent />;
                         if (id === 'chars') content = <CharacterContent />;
                         if (id === 'deepdive') content = <DeepDiveContent />;
                         if (id === 'ceo') content = <CEOContent />;
                         if (id === 'connect') content = <ConnectContent />;
                         if (id === 'buy') content = <BuyContent />;
                    }
                    const isMobile = window.innerWidth < 640;
                    const offset = prev.length * 20;
                    return [...prev, { id, title, isOpen: true, isMinimized: false, zIndex: nextZIndex, position: isMobile ? { x: 5, y: 5 } : { x: 50 + offset, y: 50 + offset }, content }];
                });
                setActiveWindowId(id);
                setNextZIndex(prev => prev + 1);
            };

            const closeWindow = (id) => setWindows(prev => prev.map(w => w.id === id ? { ...w, isOpen: false } : w));
            const minimizeWindow = (id) => setWindows(prev => prev.map(w => w.id === id ? { ...w, isMinimized: true } : w));
            const focusWindow = (id) => { setActiveWindowId(id); setWindows(prev => prev.map(w => w.id === id ? { ...w, zIndex: nextZIndex } : w)); setNextZIndex(prev => prev + 1); };
            const moveWindow = (id, newPos) => setWindows(prev => prev.map(w => w.id === id ? { ...w, position: newPos } : w));
            const restoreWindow = (id) => { setWindows(prev => prev.map(w => w.id === id ? { ...w, isMinimized: false, zIndex: nextZIndex } : w)); setNextZIndex(prev => prev + 1); setActiveWindowId(id); };
            const toggleStartMenu = () => setStartMenuOpen(!startMenuOpen);

            const DesktopIcon = ({ label, icon: Icon, id, title, content, externalLink, colorClass }) => (
                <div onClick={() => externalLink ? window.location.href = externalLink : openWindow(id, title, content)} className="flex flex-col items-center justify-center w-24 gap-1 p-2 cursor-pointer hover:bg-slate-800/50 border border-transparent hover:border-slate-600 rounded group mb-4">
                    <div className={`${colorClass || 'text-slate-200'} group-hover:text-white filter drop-shadow-md bloom-white transition-all`}><Icon /></div>
                    <span className="text-slate-200 group-hover:text-white text-center font-ui text-xs bg-slate-900/80 px-1 tracking-wider">{label}</span>
                </div>
            );

            return (
                <div className="relative w-full h-screen overflow-hidden font-term">
                    <div className="scanlines"></div>
                    <div className="screen-glow"></div>

                    {/* DESKTOP ICONS GRID - ADJUSTED FOR MOBILE (3 COLS) + Z-INDEX FIX */}
                    <div className="absolute top-0 left-0 p-4 w-full md:w-auto md:p-6 grid grid-cols-3 gap-2 md:grid-cols-1 md:gap-4 z-0">
                        <DesktopIcon label="SYSTEM_ROOT" icon={Icons.Terminal} id="welcome" title="SYSTEM_ROOT" content={<WelcomeContent openWindow={openWindow} />} colorClass="text-amber-500" />
                        <DesktopIcon label="CEO_BIO" icon={Icons.Tie} id="ceo" title="EXECUTIVE_PROFILE" content={<CEOContent />} colorClass="text-amber-600" />
                        <DesktopIcon label="PROJECT_FILES" icon={Icons.Folder} id="story" title="CHAPTER_PREVIEW.DOC" content={<StoryContent />} colorClass="text-blue-400" />
                        <DesktopIcon label="PERSONNEL_DB" icon={Icons.User} id="chars" title="PERSONNEL_DATABASE" content={<CharacterContent />} colorClass="text-blue-500" />
                        <DesktopIcon label="ANOMALY_RPTS" icon={Icons.Database} id="deepdive" title="ANOMALY_REPORTS" content={<DeepDiveContent />} colorClass="text-red-500" />
                        <DesktopIcon label="REQUISITION" icon={Icons.Disk} id="buy" title="ACQUISITION" content={<BuyContent />} colorClass="text-green-500" />
                        <DesktopIcon label="RAE_NET" icon={Icons.Mail} id="connect" title="SECURE_UPLINK" content={<ConnectContent />} colorClass="text-green-400" />
                        
                        <div className="col-span-3 md:col-span-1 h-px bg-slate-800 w-full md:w-16 mx-auto my-2"></div>
                        
                        {/* UPDATED: Log Out points to Main Site */}
                        <DesktopIcon label="LOG_OUT" icon={Icons.User} externalLink="https://lilyrosslyn.com" colorClass="text-slate-500" />
                    </div>

                    {windows.map(win => <DraggableWindow key={win.id} {...win} content={win.content || <WelcomeContent openWindow={openWindow} />} onClose={closeWindow} onMinimize={minimizeWindow} onFocus={focusWindow} onMove={moveWindow} />)}

                    <div className="absolute bottom-0 left-0 w-full h-10 bg-slate-900 border-t border-slate-700 flex items-center px-2 z-[100] shadow-2xl">
                        <button onClick={toggleStartMenu} className={`flex items-center gap-1 px-3 py-1 mr-2 border border-slate-600 text-slate-300 hover:bg-slate-800 font-ui font-bold text-sm transition-all ${startMenuOpen ? 'bg-slate-800 text-white' : ''}`}>
                            <Icons.Start /><span className="pt-0.5 bloom-white">START</span>
                        </button>
                        <div className="flex-1 flex gap-1 overflow-x-auto px-2">
                            {windows.filter(w => w.isOpen).map(win => (
                                <button key={win.id} onClick={() => win.isMinimized || activeWindowId !== win.id ? restoreWindow(win.id) : minimizeWindow(win.id)} className={`flex items-center gap-2 px-3 py-1 min-w-[120px] max-w-[200px] truncate border text-xs font-ui transition-all ${activeWindowId === win.id && !win.isMinimized ? 'bg-slate-800 text-white border-slate-500 shadow-inner bloom-white' : 'bg-slate-900 text-slate-500 border-slate-800 hover:border-slate-600'}`}>
                                    <span>{win.title}</span>
                                </button>
                            ))}
                        </div>
                        <div className="px-3 py-1 text-sm font-ui mx-1 text-amber-600 border-l border-slate-700 bloom-amber">{new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                    </div>

                    {startMenuOpen && (
                        <div className="absolute bottom-10 left-2 w-64 bg-slate-900 border border-slate-600 z-[110] flex flex-col shadow-xl">
                            <div className="bg-slate-800 text-white font-bold p-2 flex items-center gap-2 border-b border-slate-600"><span className="font-ui text-xs tracking-widest bloom-white">RAEtron OS v1.1.0</span></div>
                            <div className="p-1 flex flex-col gap-1">
                                <button onClick={() => window.location.href='console.html'} className="p-2 text-left text-green-500 hover:bg-slate-800 font-ui text-sm flex items-center gap-2 transition-colors bloom-green"><Icons.Terminal /> SYSTEM BACKDOOR</button>
                                <div className="h-px bg-slate-800 my-1"></div>
                                {/* UPDATED: Emergency Shutdown points to Main Site */}
                                <button onClick={() => window.location.href='https://lilyrosslyn.com'} className="p-2 text-left text-red-400 hover:bg-slate-800 font-ui text-sm flex items-center gap-2 transition-colors bloom-red"><span className="font-bold">⚠</span> EMERGENCY SHUTDOWN</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
