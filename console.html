<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RAEtron - SYSTEM TERMINAL</title>
    <style>
        /* --- FONTS & BASE --- */
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&family=VT323&display=swap');

        :root {
            --bg-color: #050505;
            --term-green: #33ff00;
            --term-dim: #1a8000;
            --alert-red: #ff3333;
            --scan-line: rgba(0, 255, 0, 0.1);
        }

        * { box-sizing: border-box; user-select: none; }
        
        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--term-green);
            font-family: 'VT323', monospace;
            height: 100vh;
            overflow: hidden;
            font-size: 18px;
        }

        /* --- CRT EFFECTS --- */
        .crt-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%);
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 999;
        }

        .screen-glow {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            box-shadow: inset 0 0 80px rgba(0, 255, 0, 0.2);
            pointer-events: none;
            z-index: 998;
        }

        .scanline {
            width: 100%;
            height: 100px;
            z-index: 999;
            background: linear-gradient(0deg, rgba(0,0,0,0) 0%, rgba(33, 255, 0, 0.04) 50%, rgba(0,0,0,0) 100%);
            opacity: 0.1;
            position: absolute;
            bottom: 100%;
            animation: scanline 10s linear infinite;
            pointer-events: none;
        }

        @keyframes scanline {
            0% { bottom: 100%; }
            100% { bottom: -100%; }
        }

        /* --- LAYOUT --- */
        #terminal {
            padding: 10px; /* Reduced padding for mobile */
            height: 100dvh; /* Changed from 100vh to 100dvh */
            display: flex;
            flex-direction: column;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }

        header {
            border-bottom: 2px solid var(--term-green);
            padding-bottom: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        h1 { margin: 0; font-size: 2rem; letter-spacing: 2px; text-shadow: 0 0 5px var(--term-green); }
        .status { font-size: 0.8rem; animation: blink 2s infinite; }

        /* --- CONTENT AREA --- */
        #output-screen {
            flex-grow: 1;
            /* Added min-height to prevent collapse, but max-height to ensure buttons fit */
            min-height: 0; 
            border: 1px solid var(--term-dim);
            padding: 15px;
            overflow-y: auto;
            font-family: 'Courier Prime', monospace;
            font-size: 0.9rem;
            margin-bottom: 10px; /* Reduced margin slightly */
            background: rgba(0, 50, 0, 0.1);
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.1);
        }

        .log-entry { margin-bottom: 15px; border-left: 2px solid var(--term-dim); padding-left: 10px; animation: fadein 0.3s ease-out; }
        .log-time { color: var(--term-dim); font-size: 0.7rem; margin-bottom: 3px; }
        .log-text { line-height: 1.4; word-wrap: break-word; }
        .warning-text { color: var(--alert-red); font-weight: bold; text-shadow: 0 0 5px red; }
        .success-text { color: #ccff00; font-weight: bold; }

        /* INPUT FIELD STYLE */
        .input-line {
            display: flex;
            align-items: center;
            border-left: 2px solid #ccff00;
            padding-left: 10px;
            margin-bottom: 15px;
        }
        .input-prompt { color: #ccff00; margin-right: 10px; }
        .terminal-input {
            background: transparent;
            border: none;
            color: #ccff00;
            font-family: 'Courier Prime', monospace;
            font-size: 1rem;
            width: 100%;
            outline: none;
        }

        /* --- CONTROLS --- */
        .control-panel {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr; /* 3 columns now */
            gap: 10px;
        }
        
        /* Make emergency button span full width on small screens */
        .full-width-mobile {
            grid-column: span 1;
        }

        button {
            background: black;
            border: 2px solid var(--term-green);
            color: var(--term-green);
            padding: 15px;
            font-family: 'VT323', monospace;
            font-size: 1.1rem;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.2s;
            box-shadow: 0 0 5px var(--term-dim);
            position: relative;
            overflow: hidden;
        }

        button:hover { background: var(--term-dim); color: black; box-shadow: 0 0 15px var(--term-green); }
        button:active { transform: scale(0.98); }
        button:disabled { border-color: #333; color: #333; cursor: not-allowed; box-shadow: none; background: black; }
        
        button.danger { border-color: var(--alert-red); color: var(--alert-red); }
        button.danger:hover { background: var(--alert-red); color: white; box-shadow: 0 0 15px red; }

        /* --- ANIMATIONS --- */
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        @keyframes fadein { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #001100; }
        ::-webkit-scrollbar-thumb { background: var(--term-dim); }
        ::-webkit-scrollbar-thumb:hover { background: var(--term-green); }

        /* SECRET LINK STYLE */
        .secret-link {
            display: inline-block;
            margin-top: 5px;
            padding: 8px 12px;
            background: var(--term-green);
            color: black;
            text-decoration: none;
            font-weight: bold;
            font-size: 0.9rem;
            width: 100%;
            text-align: center;
            border: 1px solid #004400;
            transition: all 0.2s;
        }
        .secret-link:hover {
            background: #ccff00;
            box-shadow: 0 0 10px #ccff00;
        }
        
        @media (max-width: 600px) {
            .control-panel {
                grid-template-columns: 1fr 1fr;
            }
            .full-width-mobile {
                grid-column: span 2;
            }
        }
    </style>
</head>
<body>

    <div class="crt-overlay"></div>
    <div class="screen-glow"></div>
    <div class="scanline"></div>

    <div id="terminal">
        <header>
            <div>
                <h1>RAEtron OS</h1>
                <div class="status">SYSTEM ONLINE // AUDIO FREQ: <span id="freq">960</span> Hz</div>
            </div>
            <div id="clock">00:00:00</div>
        </header>

        <div id="output-screen">
            <div class="log-entry">
                <div class="log-time">SYSTEM_BOOT</div>
                <div class="log-text">
                    Connection established...<br>
                    User Identity: GUEST<br>
                    WARNING: Dimensional instability detected in Sector 4.
                </div>
            </div>
        </div>

        <div class="control-panel">
            <button onclick="scanArea()" id="scan-btn">SCAN AREA</button>
            <button onclick="accessLogs()" id="log-btn">READ LOGS</button>
            <button onclick="checkInventory()" id="inv-btn">INVENTORY</button>
            <button onclick="calibrate()" id="cal-btn">CALIBRATE</button>
            <button class="danger full-width-mobile" onclick="emergencyProtocol()" id="danger-btn">EMERGENCY</button>
        </div>
    </div>

    <script>
        // --- LORE DATABASE ---
        const locations = [
            { name: "School Hallway", desc: "Blue lockers line the walls. A trophy case glimmers dimly.", anomaly: "Locker 104 is vibrating." },
            { name: "Neighborhood Park", desc: "The swings are moving, but there is no wind.", anomaly: "Shadow signature detected near the slide." },
            { name: "Zhang's Store", desc: "The neon OPEN sign is flickering in Morse code.", anomaly: "Reading 400% electromagnetic spike." },
            { name: "Cassie's House", desc: "Basement Lab. The VR headset is humming on its own.", anomaly: "The screen shows a room that doesn't exist." },
            { name: "The Alley", desc: "Dr. Stevens' abandoned lab entrance.", anomaly: "Temporal displacement: The graffiti changes when you blink." }
        ];

        const logs = [
            "Dr. Stevens Journal - Entry 4: 'I can hear them scratching at the walls. Not the rats. The shadows.'",
            "Security Report: 'Subject Robbie Kingsley was seen entering the basement at 0200 hours.'",
            "Audio Transcript: 'Don't be afraid. The machine wants to help us.'",
            "Error Log 882: 'Variables for Physics.exe have been overwritten by external entity.'",
            "RAEtron Memo: 'Acquire the asset. Eliminate the witnesses.'",
            "Vince Surveillance: 'Subject shows signs of internal conflict. Pulse elevated.'",
            "Derrick Audio File: 'The resonance is matching the key of F#. It's opening the door.'"
        ];

        const equipment = [
            "VR HEADSET (Status: MODIFIED)",
            "HAPTIC GLOVES (Status: PROTOTYPE)",
            "MOTION TRACKING ARRAY (Status: ONLINE)",
            "MAIN COMPUTER (Status: COMMODORE 64/UNSTABLE)",
            "WALKMAN (Tape: 'Strange Science Mix')"
        ];

        // --- STATE & AUDIO ---
        let calibrationCount = 0;
        const output = document.getElementById('output-screen');
        const freqDisplay = document.getElementById('freq');
        let audioCtx = null;

        // Initialize Audio
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        // Synthesizer
        function playTone(freq, type, duration) {
            initAudio();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        // Rickroll Melody (Extended)
        function playSecretTune() {
            initAudio();
            const now = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            
            osc.type = 'square'; // Chiptune style
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            
            // "Never Gonna Give You Up" Chorus
            const notes = [
                // "Never gonna give you up"
                { f: 466.16, t: 0, d: 0.15 }, // A#4
                { f: 523.25, t: 0.2, d: 0.15 }, // C5
                { f: 554.37, t: 0.4, d: 0.15 }, // C#5
                { f: 466.16, t: 0.6, d: 0.15 }, // A#4
                { f: 698.46, t: 0.8, d: 0.2 },  // F5
                { f: 698.46, t: 1.05, d: 0.2 }, // F5
                { f: 622.25, t: 1.3, d: 0.4 },  // D#5

                // "Never gonna let you down"
                { f: 466.16, t: 2.0, d: 0.15 }, // A#4
                { f: 523.25, t: 2.2, d: 0.15 }, // C5
                { f: 554.37, t: 2.4, d: 0.15 }, // C#5
                { f: 466.16, t: 2.6, d: 0.15 }, // A#4
                { f: 622.25, t: 2.8, d: 0.2 },  // D#5
                { f: 622.25, t: 3.05, d: 0.2 }, // D#5
                { f: 554.37, t: 3.3, d: 0.2 },  // C#5
                { f: 523.25, t: 3.55, d: 0.2 }, // C5
                { f: 466.16, t: 3.8, d: 0.4 },  // A#4

                // "Never gonna run around"
                { f: 466.16, t: 4.5, d: 0.15 }, // A#4
                { f: 523.25, t: 4.7, d: 0.15 }, // C5
                { f: 554.37, t: 4.9, d: 0.15 }, // C#5
                { f: 466.16, t: 5.1, d: 0.15 }, // A#4
                { f: 554.37, t: 5.3, d: 0.4 },  // C#5 (run)
                { f: 622.25, t: 5.7, d: 0.2 },  // D#5 (a-)
                { f: 554.37, t: 5.9, d: 0.2 },  // C#5 (round)
                { f: 523.25, t: 6.1, d: 0.2 },  // C5

                // "And desert you"
                { f: 466.16, t: 6.5, d: 0.15 }, // A#4
                { f: 622.25, t: 6.7, d: 0.4 },  // D#5
                { f: 698.46, t: 7.1, d: 0.4 },  // F5
                { f: 554.37, t: 7.5, d: 0.6 }   // C#5
            ];

            notes.forEach(note => {
                const o = audioCtx.createOscillator();
                const g = audioCtx.createGain();
                o.type = 'square';
                o.frequency.value = note.f;
                o.connect(g);
                g.connect(audioCtx.destination);
                g.gain.setValueAtTime(0.1, now + note.t);
                g.gain.exponentialRampToValueAtTime(0.001, now + note.t + note.d);
                o.start(now + note.t);
                o.stop(now + note.t + note.d);
            });
        }

        // --- SYSTEM FUNCTIONS ---

        // Clock & Jitter (with Warning Logic)
        setInterval(() => {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString();
            
            // Jitter range: 955 to 965
            const currentFreq = 960 + Math.floor(Math.random() * 11 - 5); 
            freqDisplay.innerText = currentFreq;
            
            // Check for EXACT 960Hz breach
            if (currentFreq === 960) {
                // Flash red
                freqDisplay.style.color = "red";
                freqDisplay.style.textShadow = "0 0 10px red";
                
                // Play Warning Sound (Short burst)
                // We do a lightweight check to not spam audio if user hasn't interacted
                if (audioCtx && audioCtx.state === 'running') {
                    // Only play occasionally to avoid annoyance (1 in 5 chance when hitting 960)
                    if (Math.random() > 0.8) {
                        playTone(150, 'sawtooth', 0.5); // Low warning drone
                        typeWriter("WARNING: DIMENSIONAL BREACH POSSIBLE AT 960Hz", true);
                    }
                }
                
                // Reset style after short delay
                setTimeout(() => {
                    freqDisplay.style.color = "inherit";
                    freqDisplay.style.textShadow = "none";
                }, 800);
            }
        }, 1000);

        function typeWriter(text, isWarning = false) {
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            
            const time = document.createElement('div');
            time.className = 'log-time';
            time.innerText = new Date().toLocaleTimeString();
            
            const content = document.createElement('div');
            content.className = isWarning ? 'log-text warning-text' : 'log-text';
            
            entry.appendChild(time);
            entry.appendChild(content);
            output.appendChild(entry);
            output.scrollTop = output.scrollHeight;

            let i = 0;
            // Only play typing blip if it's a manual action or important
            if (!text.includes("DIMENSIONAL BREACH")) {
                 playTone(800, 'square', 0.05); 
            }
            
            function type() {
                if (i < text.length) {
                    content.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(type, 10);
                }
            }
            type();
        }

        function scanArea() {
            playTone(1200, 'sine', 0.1);
            const btn = document.getElementById('scan-btn');
            btn.disabled = true;
            btn.innerText = "SCANNING...";
            
            const loc = locations[Math.floor(Math.random() * locations.length)];
            
            typeWriter(`Initiating deep scan: ${loc.name}...`);
            
            setTimeout(() => {
                typeWriter(loc.desc);
            }, 1000);

            setTimeout(() => {
                const isAnomaly = Math.random() > 0.3; 
                if (isAnomaly) {
                    playTone(400, 'sawtooth', 0.3);
                    typeWriter(`ALERT: ${loc.anomaly}`, true);
                } else {
                    typeWriter("Area appears stable... for now.");
                }
                btn.disabled = false;
                btn.innerText = "SCAN AREA";
            }, 2500);
        }

        function accessLogs() {
            playTone(600, 'triangle', 0.1);
            const randomLog = logs[Math.floor(Math.random() * logs.length)];
            typeWriter("Decrypting data fragment...");
            setTimeout(() => {
                typeWriter(randomLog);
            }, 800);
        }

        function checkInventory() {
            playTone(800, 'square', 0.1);
            typeWriter("Accessing Equipment List...");
            setTimeout(() => {
                equipment.forEach(item => {
                    const line = document.createElement('div');
                    line.className = 'log-text';
                    line.innerText = `> ${item}`;
                    line.style.color = '#00cc00';
                    output.lastChild.lastChild.appendChild(line);
                });
                output.scrollTop = output.scrollHeight;
            }, 500);
        }

        // --- CALIBRATION & EMAIL ---
        function calibrate() {
            initAudio(); 
            calibrationCount++;
            const btn = document.getElementById('cal-btn');
            
            if (calibrationCount < 3) {
                playTone(440 + (calibrationCount * 100), 'sine', 0.2);
                typeWriter(`Calibrating... Attempt ${calibrationCount}/3. Signal alignment pending.`);
            } else if (calibrationCount === 3) {
                // Play Rickroll
                playSecretTune();
                
                typeWriter(">>> FREQUENCY MATCHED <<<", true);
                typeWriter("Hidden partition unlocked.");
                
                setTimeout(() => {
                    typeWriter("Identity verification required for access.");
                    requestEmail();
                }, 8000); // Wait for tune
                
                btn.disabled = true;
                btn.innerText = "SYNCED";
                btn.style.borderColor = "#ccff00";
                btn.style.color = "#ccff00";
            }
        }

        function requestEmail() {
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `
                <div class="log-time">SECURE_LOGIN</div>
                <div class="input-line">
                    <span class="input-prompt">ENTER EMAIL ></span>
                    <input type="email" class="terminal-input" id="user-email" placeholder="agent@raetron.com" autofocus>
                </div>
            `;
            output.appendChild(entry);
            output.scrollTop = output.scrollHeight;
            
            const input = document.getElementById('user-email');
            input.focus();
            
            input.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    const email = input.value;
                    if(email && email.includes('@')) {
                        input.disabled = true;
                        processEmail(email);
                    } else {
                        typeWriter("ERROR: Invalid format. Try again.", true);
                    }
                }
            });
        }

        function processEmail(email) {
            playTone(1000, 'sine', 0.1);
            playTone(1500, 'sine', 0.1);
            
            typeWriter(`Processing credentials for ${email}...`);
            
            // --- MAILERLITE INTEGRATION ---
            const mailerLiteActionUrl = 'https://assets.mailerlite.com/jsonp/1804898/forms/165903246149289160/subscribe'; 

            const formData = new FormData();
            formData.append('fields[email]', email); 

            fetch(mailerLiteActionUrl, {
                method: 'POST',
                body: formData,
                mode: 'no-cors' 
            })
            .then(() => {
                // Success logic
                setTimeout(() => {
                    typeWriter("ACCESS GRANTED. Welcome to the resistance.");
                    typeWriter("Retrieving secure directories...");
                    
                    // DISPLAY THE MENU
                    setTimeout(() => {
                        const menuEntry = document.createElement('div');
                        menuEntry.className = 'log-entry';
                        menuEntry.style.borderLeft = "2px solid #ccff00";
                        
                        // --- UPDATED LINKS HERE ---
                        const linkPatreon = "https://www.patreon.com/cw/LilyRosslyn"; 
                        const linkShop = "https://shop.lilyrosslyn.com"; 
                        const linkDesktop = "the-project.html"; 

                        menuEntry.innerHTML = `
                            <div class="log-time">ROOT_ACCESS_MENU</div>
                            <div class="log-text success-text">
                                SELECT DESTINATION:
                            </div>
                            <div style="margin-top: 10px; display: flex; flex-direction: column; gap: 8px;">
                                <a href="${linkPatreon}" target="_blank" class="secret-link">
                                    [1] READ THE STORY (PATREON)
                                </a>
                                <a href="${linkShop}" target="_blank" class="secret-link">
                                    [2] ACQUIRE GEAR (SHOP)
                                </a>
                                <a href="${linkDesktop}" class="secret-link">
                                    [3] RETURN TO DESKTOP
                                </a>
                            </div>
                        `;
                        output.appendChild(menuEntry);
                        output.scrollTop = output.scrollHeight;
                        
                        playTone(800, 'sine', 0.1);
                        setTimeout(() => playTone(1200, 'sine', 0.2), 100);
                    }, 1000);

                }, 1000);
            })
            .catch(error => {
                console.error('Error:', error);
                // Fallback for errors
                typeWriter("Connection unstable... forcing manual override.");
                setTimeout(() => {
                     typeWriter("ACCESS GRANTED (Offline Mode).");
                     // Show reward link anyway
                     const menuEntry = document.createElement('div');
                     menuEntry.className = 'log-entry';
                     menuEntry.style.borderLeft = "2px solid #ccff00";
                     menuEntry.innerHTML = `
                        <div class="log-time">ROOT_ACCESS_MENU</div>
                        <div style="margin-top: 10px;">
                            <a href="https://www.patreon.com/cw/LilyRosslyn" target="_blank" class="secret-link">[ OPEN ARCHIVES ]</a>
                        </div>
                      `;
                      output.appendChild(menuEntry);
                      output.scrollTop = output.scrollHeight;
                }, 2000);
            });
        }

        function emergencyProtocol() {
            initAudio();
            playTone(100, 'sawtooth', 1.0); 
            
            output.innerHTML = ""; 
            const body = document.body;
            body.style.backgroundColor = "#220000";
            body.style.color = "red";
            
            document.querySelectorAll('button').forEach(b => b.disabled = true);
            
            typeWriter("CRITICAL ERROR: SHUTDOWN FAILED.", true);
            
            setTimeout(() => {
                playTone(100, 'sawtooth', 0.5);
                typeWriter("YOU CANNOT DISCONNECT.", true);
            }, 1500);
            
            setTimeout(() => {
                playTone(80, 'sawtooth', 1.0);
                typeWriter("THEY ARE ALREADY HERE.", true);
            }, 3000);
            
            setTimeout(() => {
                // REDIRECT TO KICKSTARTER
                window.location.href = "https://www.kickstarter.com/profile/lilyrosslyn"; 
            }, 5000);
        }
    </script>
</body>
</html>


